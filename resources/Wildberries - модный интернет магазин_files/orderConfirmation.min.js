(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function asyncGeneratorStep(e,r,t,o,n,i,a){try{var s=e[i](a),l=s.value}catch(e){return void t(e)}s.done?r(l):Promise.resolve(l).then(o,n)}function _asyncToGenerator(e){return function(){var r=this,t=arguments;return new Promise(function(o,n){var i=e.apply(r,t);function a(e){asyncGeneratorStep(i,o,n,a,s,"next",e)}function s(e){asyncGeneratorStep(i,o,n,a,s,"throw",e)}a(void 0)})}}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}var GoogleRemarketingService=require("../services/googleRemarketingService");!function(){var e=function(){function e(e){var r,t,o,n,i,a,s,l,u,c=this;if((Object.assign(this,e.data),this.$services.cartService.clearItems(null!==(r=null===(t=this.order.orderDetails)||void 0===t?void 0:null===(o=t.userBasketItems)||void 0===o?void 0:o.map(function(e){return e.characteristicId}))&&void 0!==r?r:[]),this.existSoldItems=(null===(n=this.order.orderDetails)||void 0===n?void 0:null===(i=n.soldBasketItems)||void 0===i?void 0:i.length)>0,this.googleTagParams=GoogleRemarketingService.getConfirmedOrderParams(null===(a=this.order.orderDetails)||void 0===a?void 0:a.userBasketItems,this.order.orderId),this.googleAnalyticsParams=GoogleRemarketingService.getGoogleAnalitycsAfterBuyParams(null===(s=this.order.orderDetails)||void 0===s?void 0:s.userBasketItems,this.order.orderId),this.googleTagParams&&this.$setGoogleTagsModel(this.googleTagParams),this.googleAnalyticsParams&&(window.dataLayer&&window.dataLayer.push(this.googleAnalyticsParams),!window.dataLayer&&(window.dataLayer=[this.googleAnalyticsParams])),!this.broken)&&(this.cod1sArr=this.order.orderDetails.userBasketItems.map(function(e){return e.cod1S}),null!==(l=this.positionsModel)&&void 0!==l&&l.positions&&(this.$services.groupedDeliveriesService.setUid(this.uid),this.$services.groupedDeliveriesService.merge(this.positionsModel)),window.wba))try{var d=this;(u=this.cod1sArr,d.$moduleLoader.loadServiceAsync("suppliersService").then(function(e){return d.$services.suppliersService.getProductSupplierByNmIdsAsync(u)})).then(function(e){var r,t,o,n,i=c.order.orderDetails.userBasketItems.map(function(r){var t,o,n,i=_toArray((null!==(t=r.targetUrl)&&void 0!==t?t:"").split("|")),a=(i[0],i[1]),s=i.slice(2),l=null===(o=e[r.cod1S])||void 0===o?void 0:o.supplierId;return{id:r.cod1S.toString(),chrt:r.characteristicId.toString(),rid:null===(n=r.orderedItemGuidsStr)||void 0===n?void 0:n.toString(),name:r.goodsName,brand:r.brandName,price:r.priceWithCouponAndDiscount,inListIndex:parseInt(a)||1,listName:s.join("|"),variant:r.colorName,quantity:r.quantity,affiliation:l,storeId:r.storeId,subjectId:r.subjectId,subjectParentId:r.subjectParentId}}),a={checkout:c.$analitic.getPurchaseCheckout(),delivery:c.deliveryWba,payment_type:c.paymentTypeWba,cart:"OnlineCart",purchase_sum:null!==(r=null===(t=c.order.orderUserInfo)||void 0===t?void 0:t.purchaseAmount)&&void 0!==r?r:0,purchase_percent:null!==(o=null===(n=c.order.orderUserInfo)||void 0===n?void 0:n.purchasePercent)&&void 0!==o?o:0};c.$analitic.sendWbaEcomStat("purchase",i,a)})}catch(e){console.log("wba exception",e)}}var r=e.prototype;return r.onAfterRender=function(){var e;if(new Swiper(document.querySelector(".j-sw-slider-bought-goods .swiper-container"),{slidesPerView:"auto",spaceBetween:16,updateOnWindowResize:"true",watchOverflow:"true",lazy:!0,navigation:{nextEl:".j-sw-slider-bought-goods .swiper-button-next",prevEl:".j-sw-slider-bought-goods .swiper-button-prev"}}),null===(e=wb.basket)||void 0===e||e.basketShortInit(),null!=this.paymentUrl){var r=new URL(window.location.href);r.searchParams.delete("paymentUrl"),window.history.replaceState(window.history.state,document.title,r.toString()),window.location.replace(this.paymentUrl)}this._refreshBalanceIfNecessary()},r.getScreenName=function(){return"TYP"},r.showUnopenedAppPopup=function(){if(null!=this.paymentUrl){var e=new URL(this.paymentUrl);e.protocol="https:",e.hash="";var r=wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["popup-default-bank-app","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,onShow:function(t){$.views.templates.openDefaultBankPopup.link(t.querySelector(".popup__content"),{link:e.toString()},{close:function(){return r.close()}})}})}},r._refreshBalanceIfNecessary=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r,t,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(r=this.order)&&void 0!==r&&r.orderDetails){e.next=2;break}return e.abrupt("return");case 2:if((this.order.orderDetails.paymentType.isCreditCard||this.order.orderDetails.paymentType.isQRC||this.order.orderDetails.paymentType.isBalance)&&!this.order.orderDetails.paymentType.isCash){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.$user.getBalance();case 6:if(e.t2=o=e.sent,e.t1=null===e.t2,e.t1){e.next=10;break}e.t1=void 0===o;case 10:if(!e.t1){e.next=14;break}e.t3=void 0,e.next=15;break;case 14:e.t3=o.moneyBalance;case 15:if(e.t4=t=e.t3,e.t0=null!==e.t4,!e.t0){e.next=19;break}e.t0=void 0!==t;case 19:if(!e.t0){e.next=23;break}e.t5=t,e.next=24;break;case 23:e.t5=0;case 24:e.t5>0&&this.$user.resetBalance();case 26:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),e}();wb.spa.registerViewModel(e,!0)}();

},{"../services/googleRemarketingService":2}],2:[function(require,module,exports){
"use strict";var GoogleRemarketingService=function(){function n(){}return n.getBasketParams=function(n){if(null==n||!n.length)return null;var e=n.map(function(n){return n.priceSumWithCouponAndDiscount});return{Bquantity:n.length,Bvalue:e.reduce(function(n,e){return n+e},0),Delivery:"Бесплатная доставка",PageType:"cart",ProdID:n.map(function(n){return n.cod1S}),Ptype:n.map(function(n){return n.goodsName}),Value:e}},n.getConfirmedOrderParams=function(n,e){return null!=n&&n.length?{PageType:"purchase",OrderId:e,ProdID:n.map(function(n){return n.cod1S}),Value:n.map(function(n){return Math.round(n.priceWithCouponAndDiscount)}),Ptype:n.map(function(n){return n.goodsName}),Bquantity:n.length,Bvalue:n.map(function(n){return n.priceSumWithCouponAndDiscount})}:null},n.getGoogleAnalitycsAfterBuyParams=function(n,e){return null!=n&&n.length?{event:"ecomm-transaction",ecommerce:{purchase:{actionField:{id:e,revenue:n.map(function(n){return n.priceSumWithCouponAndDiscount}).sum()},products:n.map(function(n){return{id:n.cod1S.toString(),name:n.goodsName,brand:n.brandName,price:n.priceWithCouponAndDiscount,quantity:n.quantity,variant:n.colorName,size:n.sizeName}})}}}:null},n}();module.exports=GoogleRemarketingService;

},{}]},{},[1]);
